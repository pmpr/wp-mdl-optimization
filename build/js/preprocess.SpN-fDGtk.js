/*! For license information please see preprocess.SpN-fDGtk.js.LICENSE.txt */
!function(){const e=PRHelper.getHTML(),t=PRHelper.getType(),a=PRHelper.getHook(),o=PRHelper.getServer(),n=PRHelper.getRequest(),s=PRHelper.getSetting();a.on("load",c);let r={};function c(){r={},n.ajax(s.getOption("ajax.get_pages")).onSuccess((e=>{const a=e;t.isEmpty(a)||i(a)})).onError((e=>{console.log(e)})).addNonce().send()}function i(e,a=0){if(e.hasOwnProperty(a)){const t=e[a].id,o=e[a].url;d(t,o,"desktop").then((()=>{d(t,o,"mobile").then((()=>{i(e,++a)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else t.isEmpty(r)||(o=r,n.ajax(s.getOption("ajax.update_pages")).addNonce().onSuccess(c).send({pages:o}));var o}async function d(n,s,c){return new Promise(((i,d)=>{void 0!==r[n]&&void 0!==r[n][c]&&d("metric already extracted.");const p=o.addParams({"dont-opt":1,"pr-opt-preprocess":1,"page-id":n,device:c},s),l=e.createElement(`<iframe id="calc_metrics" data-device="${c}"  src="${p}" class="${c}"/>`),g=(e,t)=>{l.remove(),a.removeListener("message",m)},m=e=>{e.data.device===c&&parseInt(e.data.page_id)===parseInt(n)&&(requestID=null,PRHelper.getTool().isSameBaseDomain(e.origin)?"sendData"===e.data.type&&void 0!==e.data.metrics?(void 0===r[n]&&(r[n]={}),t.each(e.data.metrics,((e,t)=>{void 0===r[n][t]&&(r[n][t]={}),r[n][t][c]=e})),g(),i("preprocess.")):(g(),d("can not detect lcp item.")):console.warn("Origin not allowed:",e.origin))};e.append(l,"body"),a.on("message",m)}))}}();