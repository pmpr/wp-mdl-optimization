/*! For license information please see pagemanager.fsjWurlY-.js.LICENSE.txt */
(()=>{var e={510:(e,t,a)=>{"use strict";a.r(t)}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a(510),function(){const e=PRHelper.getHTML(),t=PRHelper.getType(),a=PRHelper.getHook(),r=PRHelper.getForm(),n=PRHelper.getTool(),s=PRHelper.getFormat(),o=PRHelper.getSetting(),g=PRHelper.getRequest(),p=PRBackendHelper.getForm(),l=PRBackendHelper.getModal(),c={onFinish:t=>{const a=t.getData("html");a&&e.fadeIn(t.element,{start:()=>{e.replace(a,t.element,!0)}})},onFail:t=>{const a=t.getData("html");a&&e.fadeIn(t.element,{start:()=>{e.replace(a,t.element,!0)}})}},i=s.parseArgs({autorun:!1},c),d=s.parseArgs({autorun:!0,validator:t=>new Promise(((a,r)=>{g.ajax(o.getOption("pagemanager.ajax.check_pattern_run")).addNonce().onSuccess((e=>{"in-progress"!==e.status?(t.addData("latest_run",e.latest_run),t.addData("pages_cache",e.pages_cache),a(!0)):a(!1)})).onError((e=>{a(!0)})).send({pattern:e.getData(t.element,"pattern")})})),onFinish:t=>{const a=t.getData("latest_run"),r=t.getData("pages_cache");if(r){const a=e.getParent(t.element,"tr"),n=e.getElement(".target_pages_cache",a);e.fadeIn(n,{start:()=>{e.replace(r,n),m(e.getElement(".pr-progress",n))}})}a&&e.fadeIn(t.element,{start:()=>{e.replace(a,t.element,!0)}})}},c);function u(r,n){a.bubbling("click",(a=>{let p=e.getTarget(a,`.opt-pattern-${r}`),c=p.closest(".pr-modal-container");e.setElementActivity(p,!1),g.ajax(o.getOption(`pagemanager.ajax.${n}_pattern`)).addNonce().onSuccess((a=>{if(t.isEmpty(a.pattern_progressbar))window.location.reload();else{const t=e.getParent(p,"tr"),r=e.getElement(".latest_run_status",t);targetPagesCache=e.getElement(".target_pages_cache",t),e.fadeIn(r,{start:()=>{e.replace(a.pattern_progressbar,r)}}),e.fadeIn(targetPagesCache,{start:()=>{e.replace(a.pages_cache_status,targetPagesCache)}});const n=e.getElement(".pr-progress",r);PRProgress.start(n,PRHelper.getFormat().parseArgs({onStart:()=>{l.getCurrent().close()}},d))}})).onError((e=>{l.getCurrent().showMessage(s.error2string(e))})).onFinally((()=>{e.setElementActivity(p,!0)})).send({link:e.getValue(e.getElement("input[name=candidate_page_link]",c)),pattern:e.getData(p,"pattern")})}),`.opt-pattern-${r}`)}function m(t){const a=PRProgress.start(t,i),r=setInterval((()=>((t,a)=>{a.finished?clearInterval(r):g.ajax(o.getOption("pagemanager.ajax.pages_cache_progress")).addNonce().onSuccess((e=>{void 0!==e.progress?(a.move(Math.floor(e.progress)),e.progress>=100&&(clearInterval(r),a.addData("html",e.status))):(a.addData("html",e.status),a.fail())})).onError((e=>{a.fail(),a.addData("html",e.status),console.log(e)})).onFinally((()=>{})).send({pattern:e.getData(t,"pattern")})})(t,a)),2e4)}t.each(e.getElements(".target_pages_cache > .check-pages-cache"),(t=>{var a;a=t,g.ajax(o.getOption("pagemanager.ajax.pages_cache_status")).addNonce().onSuccess((t=>{const r=e.getParent(a);e.fadeIn(r,{start:()=>{e.replace(t,r);const a=e.getElement(".pr-progress",r);e.isElement(a)&&m(a)}})})).send({pattern:e.getData(a,"pattern")})})),PRProgress.startAll(d,".pr-progress.pattern-run"),a.bubbling("click",(t=>{const a=e.getTarget(t,"button");l.getCurrent().showSpinner(),g.ajax(o.getOption("pagemanager.ajax.purge_pattern_pages_cache")).addNonce().onSuccess((e=>{l.getCurrent().showMessage(e,"success"),setTimeout((()=>{n.reload()}),5e3)})).onError((e=>{l.getCurrent().hideSpinner(),l.getCurrent().showMessage(s.error2string(e))})).send({pattern:e.getData(a,"pattern")})}),".opt-pattern-purge-pages-cache"),a.on("change paste input",(a=>{const n=e.getTarget(a,"input");r.getFieldContainer(n),r.inputDelay(n,(()=>{let a=e.getValue(n),r=n.closest(".pr-modal-container"),l=e.getElement(".opt-pattern-optimize",r);if(t.isEmpty(a))e.setElementActivity(l,!0,!1);else if(!s.isURL(a)||s.isExternalURL(a))p.showFieldMessage(n,o.getOption("pagemanager.invalid_url"));else{let t=e.getValue(e.getElement("input[name=pattern]",r));e.setElementActivity(l,!1,!1),g.ajax(o.getOption("pagemanager.ajax.check_candidate_link")).addNonce().onSuccess((t=>{p.showFieldMessage(n,"",!1),e.setElementActivity(l,!0,!1)})).onError((e=>{p.showFieldMessage(n,s.error2string(e))})).send({link:a,pattern:t})}}),1500)}),"input[name=candidate_page_link]"),u("setup","setup"),u("re-optimize","reoptimize")}()})();