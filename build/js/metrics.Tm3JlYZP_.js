/*! For license information please see metrics.Tm3JlYZP_.js.LICENSE.txt */
!function(){const e=PRHelper.getHTML(),t=PRHelper.getType(),n=PRHelper.getHook(),o=PRHelper.getServer(),c=PRHelper.getRequest(),a=PRHelper.getSetting();n.on("load",r);let i={};function r(){i={},c.ajax(a.getOption("ajax.get_pages")).onSuccess((e=>{const n=e;t.isEmpty(n)||s(n)})).onError((e=>{console.log(e)})).addNonce().send()}function s(e,n=0){if(e.hasOwnProperty(n)){const t=e[n].id,o=e[n].url;d(t,o,"desktop").then((()=>{d(t,o,"mobile").then((()=>{s(e,++n)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else t.isEmpty(i)||(o=i,c.ajax(a.getOption("ajax.update_pages")).addNonce().onSuccess(r).send({pages:o}));var o}async function d(n,c,a){return new Promise(((r,s)=>{void 0!==i[n]&&void 0!==i[n][a]&&s("metric already extracted.");const d=o.addParams({"dont-opt":1,"calc-metrics":1,device:a},c),l=e.createElement(`<iframe id="calc_metrics" data-device="${a}"  src="${d}" class="${a}"/>`);l.onload=()=>{const e=l.contentWindow,o=e.opt_lcp,c=Array.from(e.document.getElementsByTagName("img")).filter((t=>{const n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(e.innerHeight||document.documentElement.clientHeight)&&n.right<=(e.innerWidth||document.documentElement.clientWidth)})).map((e=>e.src));t.isEmpty(o)?s("can not detect lcp item."):(void 0===i[n]&&(i[n]={lcp:{},atf_images:{}}),i[n].lcp[a]=o,i[n].atf_images[a]=c,l.remove(),r("lcp item extracted."))},e.append(l,"body")}))}}();