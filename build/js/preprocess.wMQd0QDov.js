/*! For license information please see preprocess.wMQd0QDov.js.LICENSE.txt */
!function(){const e=PRHelper.getHTML(),o=PRHelper.getType(),t=PRHelper.getHook(),a=PRHelper.getServer(),n=PRHelper.getRequest(),s=PRHelper.getSetting();t.on("load",d);let c={desktop:{},mobile:{}},r={},i=!1;function d(){r={},n.ajax(s.getOption("ajax.get_pages")).onSuccess((e=>{const t=e;o.isEmpty(t)||p(t)})).onError((e=>{console.log(e)})).addNonce().send()}function p(e,t=0){if(e.hasOwnProperty(t)){const o=e[t].id,a=e[t].url;l(o,a,"desktop").then((()=>{l(o,a,"mobile").then((()=>{p(e,++t)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else o.isEmpty(r)||(a=r,n.ajax(s.getOption("ajax.update_pages")).addNonce().onSuccess(d).send({pages:a}));var a}async function l(n,s,d){return new Promise(((p,l)=>{void 0!==r[n]&&void 0!==r[n][d]&&l("metric already extracted.");const g=a.addParams({"dont-opt":1,"pr-opt-preprocess":1,device:d},s),m=e.createElement(`<iframe id="calc_metrics" data-device="${d}"  src="${g}" class="${d}"/>`),v=e=>{PRHelper.getTool().isSameBaseDomain(e.origin)?"sendData"===e.data.type&&void 0!==e.data.metrics?(void 0===r[n]&&(r[n]={}),o.each(e.data.metrics,((e,o)=>{void 0===r[n][o]&&(r[n][o]={}),r[n][o][d]=e})),c[d][n].remove(),p("preprocess.")):(c[d][n].remove(),l("can not detect lcp item.")):console.warn("Origin not allowed:",e.origin)};c[d][n]=m,e.append(m,"body"),i||(t.on("message",v),i=!0)}))}}();