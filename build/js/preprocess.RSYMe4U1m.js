/*! For license information please see preprocess.RSYMe4U1m.js.LICENSE.txt */
!function(){const e=PRHelper.getHTML(),o=PRHelper.getType(),t=PRHelper.getHook(),a=PRHelper.getServer(),n=PRHelper.getRequest(),s=PRHelper.getSetting();t.on("load",r);let c={};function r(){c={},n.ajax(s.getOption("ajax.get_pages")).onSuccess((e=>{const t=e;o.isEmpty(t)||i(t)})).onError((e=>{console.log(e)})).addNonce().send()}function i(e,t=0){if(e.hasOwnProperty(t)){const o=e[t].id,a=e[t].url;d(o,a,"desktop").then((()=>{d(o,a,"mobile").then((()=>{i(e,++t)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else o.isEmpty(c)||(a=c,n.ajax(s.getOption("ajax.update_pages")).addNonce().onSuccess(r).send({pages:a}));var a}async function d(n,s,r){return new Promise(((i,d)=>{void 0!==c[n]&&void 0!==c[n][r]&&d("metric already extracted.");const p=a.addParams({"dont-opt":1,"pr-opt-preprocess":1,device:r},s),l=e.createElement(`<iframe id="calc_metrics" data-device="${r}"  src="${p}" class="${r}"/>`),g=()=>{l.remove(),t.removeListener("message",m)},m=e=>{PRHelper.getTool().isSameBaseDomain(e.origin)?"sendData"===e.data.type&&void 0!==e.data.metrics?(void 0===c[n]&&(c[n]={}),o.each(e.data.metrics,((e,o)=>{void 0===c[n][o]&&(c[n][o]={}),c[n][o][r]=e})),g(),i("preprocess.")):(g(),d("can not detect lcp item.")):console.warn("Origin not allowed:",e.origin)};e.append(l,"body"),t.on("message",m)}))}}();