/*! For license information please see preprocess.eFRsxuK1P.js.LICENSE.txt */
!function(){const e=PRHelper.getHTML(),t=PRHelper.getType(),a=PRHelper.getHook(),o=PRHelper.getServer(),n=PRHelper.getRequest(),r=PRHelper.getSetting();a.on("load",c);let s={};function c(){s={},n.ajax(r.getOption("ajax.get_pages")).onSuccess((e=>{const a=e;t.isEmpty(a)||i(a)})).onError((e=>{console.log(e)})).addNonce().send()}function i(e,a=0){if(e.hasOwnProperty(a)){const t=e[a].id,o=e[a].url;d(t,o,"desktop").then((n=>{null===n?i(e,++a):d(t,o,"mobile").then((()=>{i(e,++a)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else t.isEmpty(s)||(o=s,n.ajax(r.getOption("ajax.update_pages")).addNonce().onSuccess(c).send({pages:o}));var o}async function d(n,r,c){return new Promise(((i,d)=>{void 0!==s[n]&&void 0!==s[n][c]&&d("metric already extracted.");let l=!1;const p=o.addParams({"dont-opt":1,"pr-opt-preprocess":1,"page-id":n,device:c},r),g=e.createElement(`<iframe id="calc_metrics" data-device="${c}"  src="${p}" class="${c}"/>`),m=(e,t)=>{l||(l=!0,g.remove(),a.removeListener("message",v))},u=setTimeout((()=>{m(),i(null)}),1e4),v=e=>{e.data.device===c&&parseInt(e.data.page_id)===parseInt(n)&&(requestID=null,PRHelper.getTool().isSameBaseDomain(e.origin)?(clearTimeout(u),"sendData"===e.data.type&&void 0!==e.data.metrics?(void 0===s[n]&&(s[n]={}),t.each(e.data.metrics,((e,t)=>{void 0===s[n][t]&&(s[n][t]={}),s[n][t][c]=e})),m(),i("preprocess.")):(m(),d("can not detect lcp item."))):console.warn("Origin not allowed:",e.origin))};g.addEventListener("error",(()=>{m(),console.warn("can not load iframe"),i(null)})),e.append(g,"body"),a.on("message",v)}))}}();