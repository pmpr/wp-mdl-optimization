<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             68a0bdd937640             |
    |_______________________________________|
*/
 namespace Pmpr\Module\Optimization\Optimizer\Asset; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Module\Optimization\Optimization; use Pmpr\Module\Optimization\Optimizer\Cache\VirtualBrowser\Setting as VirtualBrowserSetting; use Pmpr\Module\Optimization\Optimizer\Buffer\Engine; use Pmpr\Module\Optimization\Traits\RegexTrait; class Delay extends Engine { use RegexTrait; protected array $excludes = []; public function kgquecmsgcouyaya() { $this->miasamwyaiagioug([$this, 'aegkqemcmuccigeg'], 26)->miasamwyaiagioug([$this, 'gswmeqeyeeiqyigy'], 27)->miasamwyaiagioug([$this, 'mkyamowayqkwymmm'], 26)->miasamwyaiagioug([$this, 'qkiuyayyieegkguw'], 25); } public function mkyamowayqkwymmm($moooemyaqewumiay) { if (Constants::eqewsqmqmsiocaeg === $this->weysguygiseoukqw(VirtualBrowserSetting::eoeewcigeywcquis) && $this->weysguygiseoukqw(VirtualBrowserSetting::ysqismgmgqwekqsu) && $this->isgmmgcaqsguwias()->asgqmkcukouykiie()->ocysssyiuaueqiei()) { $sogksuscggsicmac = $this->uwqicuuwkamyewyu($moooemyaqewumiay); $this->excludes = $this->yyymaeeksgioeiai('excluded_delay_styles'); $scuukmeowggaqeea = preg_replace_callback('/<link\\s+(?<attr>[^>]*?)\\/?>/Umsi', [$this, 'koeumuimmqukceww'], $sogksuscggsicmac); if ($scuukmeowggaqeea) { $moooemyaqewumiay = $this->auyeeommieeqigum($scuukmeowggaqeea); } } return $moooemyaqewumiay; } public function koeumuimmqukceww($meyiiwcswqmuggyg) : string { $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc] = trim($meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); $mkyamowayqkwymmm = $meyiiwcswqmuggyg[0]; if (!empty($meyiiwcswqmuggyg[Constants::aiawiouiowouwomc])) { if (!preg_match('/rel\\s*=\\s*["\'](stylesheet)["\']/i', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]) || $this->caokeucsksukesyo()->owgcciayoweymuws()->skksumsyamssouqc($meyiiwcswqmuggyg[Constants::aiawiouiowouwomc], 'type=') !== false && !preg_match('/type\\s*=\\s*["\'](?:text|application)\\/(?:(?:x\\-)?css)["\']/i', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc])) { return $meyiiwcswqmuggyg[0]; } foreach ($this->excludes as $eouekqmooogkoqoo) { if (preg_match("#{$eouekqmooogkoqoo}#i", $meyiiwcswqmuggyg[0])) { $this->caokeucsksukesyo()->mskuyeumceaigegs()->debug("Optimization DelayCSS: Style {$meyiiwcswqmuggyg[0]} excluded by {$eouekqmooogkoqoo}"); return $meyiiwcswqmuggyg[0]; } } $kewwyuqsuygmksco = preg_replace('/type=(["\'])(.*?)\\1/i', 'data-pr-opt-$0', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc], 1); if (null !== $kewwyuqsuygmksco) { $mkyamowayqkwymmm = preg_replace('#' . preg_quote($meyiiwcswqmuggyg[Constants::aiawiouiowouwomc], '#') . '#i', $kewwyuqsuygmksco, $meyiiwcswqmuggyg[0], 1); } } return preg_replace('/<link/i', '<link type="text/html" class="optdelayasset" media="print" ', $mkyamowayqkwymmm, 1); } public function qkiuyayyieegkguw($moooemyaqewumiay) { $aiamqeawckcsuaou = $this->weysguygiseoukqw(VirtualBrowserSetting::kkygieaguayewaak); if ($aiamqeawckcsuaou && Constants::NONE !== $aiamqeawckcsuaou && Constants::eqewsqmqmsiocaeg === $this->weysguygiseoukqw(VirtualBrowserSetting::eoeewcigeywcquis) && $this->isgmmgcaqsguwias()->asgqmkcukouykiie()->ocysssyiuaueqiei()) { $this->excludes = $this->yyymaeeksgioeiai(VirtualBrowserSetting::gkqwyqeuosecqkqy); $sogksuscggsicmac = $this->uwqicuuwkamyewyu($moooemyaqewumiay); $scuukmeowggaqeea = preg_replace_callback('/<link\\s+([^>]+[\\s"\'])?href\\s*=\\s*[\'"]\\s*?(?<url>[^\'"]+\\.css(?:\\?[^\'"]*)?)\\s*?[\'"]([^>]+)?\\/?>/Umsi', [$this, 'sqcueoauekqwimom'], $sogksuscggsicmac); if ($scuukmeowggaqeea) { $moooemyaqewumiay = $this->auyeeommieeqigum($scuukmeowggaqeea); } } return $moooemyaqewumiay; } public function sqcueoauekqwimom($meyiiwcswqmuggyg) : string { foreach ($this->excludes as $eouekqmooogkoqoo) { if (preg_match("#{$eouekqmooogkoqoo}#i", $meyiiwcswqmuggyg[0])) { return $meyiiwcswqmuggyg[0]; } } return ''; } public function aegkqemcmuccigeg($moooemyaqewumiay) { if ($moooemyaqewumiay && $this->weysguygiseoukqw(Setting::acmmwemggiumsoyo) && $this->isgmmgcaqsguwias()->asgqmkcukouykiie()->ocysssyiuaueqiei()) { $this->excludes = $this->yyymaeeksgioeiai(Setting::goaeqsqkouyekmoo); $sogksuscggsicmac = $this->uwqicuuwkamyewyu($moooemyaqewumiay); $scuukmeowggaqeea = preg_replace_callback('/<\\s*script\\s*(?<attr>[^>]*?)?>(?<content>.*?)?<\\s*\\/\\s*script\\s*>/ims', [$this, 'eeyeswcakgiemcog'], $sogksuscggsicmac); if ($scuukmeowggaqeea) { $moooemyaqewumiay = $this->auyeeommieeqigum($scuukmeowggaqeea); } } return $moooemyaqewumiay; } public function eeyeswcakgiemcog($meyiiwcswqmuggyg) : string { if ($this->caokeucsksukesyo()->owgcciayoweymuws()->skksumsyamssouqc($meyiiwcswqmuggyg[0], 'pr-opt-dont-delay')) { return $meyiiwcswqmuggyg[0]; } foreach ($this->excludes as $eouekqmooogkoqoo) { if (preg_match("#{$eouekqmooogkoqoo}#i", $meyiiwcswqmuggyg[0])) { $this->caokeucsksukesyo()->mskuyeumceaigegs()->debug("Optimization DelayJS: Script {$meyiiwcswqmuggyg[0]} excluded by {$eouekqmooogkoqoo}"); return $meyiiwcswqmuggyg[0]; } } if (empty($meyiiwcswqmuggyg[Constants::aiawiouiowouwomc])) { return $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->ssqqsemoqaeqcqka($meyiiwcswqmuggyg[Constants::ssmskyqgcmeiayco], [Constants::squoamkioomemiyi => 'text/html', 'class' => 'optdelayasset']); } $giioumomcoyuauuw = ['text/javascript', 'module', 'application/javascript', 'application/ecmascript', 'application/x-ecmascript', 'application/x-javascript', 'text/ecmascript', 'text/javascript1.0', 'text/javascript1.1', 'text/javascript1.2', 'text/javascript1.3', 'text/javascript1.4', 'text/javascript1.5', 'text/jscript', 'text/livescript', 'text/x-ecmascript', 'text/x-javascript']; $gigaegackcaiegaq = '/type\\s*=\\s*(["\'])(?<type>.*)\\1/i'; preg_match($gigaegackcaiegaq . 'U', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc], $cywkesmoekaioooc); if (!empty($cywkesmoekaioooc) && !empty(trim($cywkesmoekaioooc[Constants::squoamkioomemiyi])) && !in_array(strtolower(trim($cywkesmoekaioooc[Constants::squoamkioomemiyi])), $giioumomcoyuauuw, true)) { return $meyiiwcswqmuggyg[0]; } $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc] = preg_replace('/\\s*[^"]async|async[^"]/i', ' data-async ', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc] = preg_replace('/\\s*[^"]defer|defer[^"]/i', ' data-defer ', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc] = preg_replace($gigaegackcaiegaq, 'data-pr-opt-type=$1$2$1', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc] = preg_replace('/(\\s+type\\s+)|(^type\\s+)|(\\s+type$)/i', '', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); $ouoigkmgsyscaucw = '/src\\s*=\\s*(["\'])(.*)\\1/i'; $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc] = preg_replace($ouoigkmgsyscaucw, 'data-pr-opt-src=$1$2$1', $meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); $wwgucssaecqekuek = trim($meyiiwcswqmuggyg[Constants::aiawiouiowouwomc]); if ($this->caokeucsksukesyo()->owgcciayoweymuws()->skksumsyamssouqc($wwgucssaecqekuek, 'class=')) { $wwgucssaecqekuek = str_replace(['class="', 'class=\''], ['class="optdelayasset ', 'class=\'optdelayasset '], $wwgucssaecqekuek); } else { $wwgucssaecqekuek .= ' class="optdelayasset"'; } return '<script type="text/html" ' . $wwgucssaecqekuek . '>' . $meyiiwcswqmuggyg[Constants::ssmskyqgcmeiayco] . '</script>'; } public function gswmeqeyeeiqyigy($moooemyaqewumiay) { if ($this->uyiwwseekuwoeoag()) { $swqimwqeweekeusq = $this->caokeucsksukesyo()->wgqqgewcmcemoewo(); $oiqkocciuiuqggew = $this->caokeucsksukesyo()->usugyumcgeaaowsi()->souwykwwmyygqyqi($this, 'delay.js', ['load_approach' => $this->weysguygiseoukqw(Setting::acmmwemggiumsoyo, Setting::oqiaceqksggqgoww)]); if ($oiqkocciuiuqggew) { $kuoicyiuewoqyaqe = $swqimwqeweekeusq->ssqqsemoqaeqcqka($oiqkocciuiuqggew, ['class' => 'pr-opt-delay']); $moooemyaqewumiay = $swqimwqeweekeusq->cgeyeoimiuyogose($moooemyaqewumiay, 'body', $kuoicyiuewoqyaqe); } $gacsgayqmwmckmwo = $swqimwqeweekeusq->ssqqsemoqaeqcqka($this->aquaommioywqokos(), ['class' => 'pr-opt-delay-fallback']); $moooemyaqewumiay = $swqimwqeweekeusq->cgeyeoimiuyogose($moooemyaqewumiay, 'body', $gacsgayqmwmckmwo); } return $moooemyaqewumiay; } public function aquaommioywqokos() : string { return 'if(navigator.userAgent.match(/MSIE|Internet Explorer/i)||navigator.userAgent.match(/Trident\\/7\\..*?rv:11/i)){var href=document.location.href;if(!href.match(/[?&]nowpopt/)){if(href.indexOf("?")==-1){if(href.indexOf("#")==-1){document.location.href=href+"?nowpopt=1"}else{document.location.href=href.replace("#","?nowpopt=1#")}}else{if(href.indexOf("#")==-1){document.location.href=href+"&nowpopt=1"}else{document.location.href=href.replace("#","&nowpopt=1#")}}}}'; } public function yyymaeeksgioeiai(string $amakmumgguksgmum) : array { $couiucmsqaieciue = $this->kmuweyayaqoeqiyw()->gugawkcggyameeky($amakmumgguksgmum); $couiucmsqaieciue = (array) $this->ocksiywmkyaqseou(Optimization::kgswyesggeyekgmg . 'asset_delay_excludes', $couiucmsqaieciue, $amakmumgguksgmum); array_map(static function ($eqgoocgaqwqcimie) { if (!is_string($eqgoocgaqwqcimie)) { $eqgoocgaqwqcimie = (string) $eqgoocgaqwqcimie; } return str_replace(['+', '?ver', '#'], ['\\+', '\\?ver', '\\#'], $eqgoocgaqwqcimie); }, $couiucmsqaieciue); return $couiucmsqaieciue; } public function uyiwwseekuwoeoag() : bool { return $this->weysguygiseoukqw(Setting::acmmwemggiumsoyo) && $this->isgmmgcaqsguwias()->asgqmkcukouykiie()->ocysssyiuaueqiei(); } }
